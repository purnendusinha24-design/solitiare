<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Spider Solitaire — Flower Backs</title>

<style>
:root {
  --card-back-url: url("https://cdn.pixabay.com/photo/2018/02/23/12/38/flower-3175428_1280.jpg");
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
    sans-serif;
  background: radial-gradient(circle at top, #166534, #065f46 40%, #022c22 80%);
  color: #f9fafb;
  user-select: none;
}

header {
  padding: 10px 20px;
  background: #0f172a;
  border-bottom: 2px solid #1e293b;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
}

header h1 {
  font-size: 18px;
  margin: 0;
  white-space: nowrap;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.difficulty {
  display: flex;
  gap: 0.4rem;
}

.diff-btn,
#newGameBtn {
  background: #2563eb;
  border: none;
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  color: #f9fafb;
  transition: background 0.15s ease, transform 0.08s ease,
    box-shadow 0.15s ease;
}

.diff-btn:hover,
#newGameBtn:hover {
  background: #1d4ed8;
  transform: translateY(-1px);
}

.diff-btn.active {
  background: #facc15;
  color: #111827;
  box-shadow: 0 0 0 2px rgba(250, 204, 21, 0.8);
}

main {
  padding: 15px;
}

#top-row {
  display: flex;
  justify-content: space-between;
  padding: 0 20px;
  align-items: flex-start;
}

.stock {
  width: 90px;
  height: 120px;
  border-radius: 8px;
  background-image: var(--card-back-url);
  background-size: cover;
  border: 1px solid #000;
  position: relative;
  cursor: pointer;
}

.stock-count {
  position: absolute;
  bottom: 4px;
  right: 6px;
  background: rgba(0, 0, 0, 0.6);
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 12px;
}

.foundation-slot {
  width: 90px;
  height: 120px;
  border-radius: 8px;
  border: 2px dashed #9ca3af;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  color: #d1d5db;
}

#foundations {
  display: flex;
  gap: 8px;
}

#hint {
  font-size: 0.8rem;
  opacity: 0.9;
  margin: 8px 20px 0;
}

#tableau {
  margin-top: 24px;
  display: flex;
  justify-content: center;
  gap: 12px;
}

.column {
  width: 90px;
  min-height: 120px;
  position: relative;
}

.card {
  width: 90px;
  height: 120px;
  border-radius: 8px;
  position: absolute;
  left: 0;
  background-size: cover;
  background-position: center;
  border: 1px solid #111827;
  cursor: pointer;
  box-shadow: 0 10px 18px rgba(15, 23, 42, 0.9);
}

.card.face-down {
  background-image: var(--card-back-url);
}

.card.face-up {
  background: #ffffff;
  color: #111827;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 6px;
  font-weight: 600;
}

.rank-top,
.rank-bottom {
  display: flex;
  justify-content: space-between;
  font-size: 0.9rem;
}
.rank-bottom {
  transform: rotate(180deg);
}

.center-suit {
  text-align: center;
  font-size: 2rem;
}

.suit {
  font-weight: 700;
}

.suit-spades,
.suit-clubs {
  color: #000000;
}
.suit-hearts,
.suit-diamonds {
  color: #b91c1c;
}

.card.selected {
  outline: 3px solid #facc15;
  transform: translateY(-5px);
}

/* Responsive */
@media (max-width: 900px) {
  header {
    flex-direction: column;
    align-items: flex-start;
  }
  header h1 {
    font-size: 16px;
  }
  .header-right {
    width: 100%;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  #tableau {
    gap: 8px;
  }
  .column,
  .card,
  .stock,
  .foundation-slot {
    width: 70px;
    height: 95px;
  }
}
</style>
</head>

<body>
<header>
  <h1>Spider Solitaire — Flower Backs</h1>
  <div class="header-right">
    <div class="difficulty">
      <button class="diff-btn active" data-diff="easy">Easy (1 Suit)</button>
      <button class="diff-btn" data-diff="medium">Medium (2 Suits)</button>
      <button class="diff-btn" data-diff="hard">Hard (4 Suits)</button>
    </div>
    <button id="newGameBtn">New Game</button>
  </div>
</header>

<main>
  <div id="top-row">
    <div>
      <div class="stock" id="stock">
        <span id="stockCount" class="stock-count"></span>
      </div>
    </div>

    <div id="foundations">
      <div class="foundation-slot"></div>
      <div class="foundation-slot"></div>
      <div class="foundation-slot"></div>
      <div class="foundation-slot"></div>
      <div class="foundation-slot"></div>
      <div class="foundation-slot"></div>
      <div class="foundation-slot"></div>
      <div class="foundation-slot"></div>
    </div>
  </div>

  <div id="hint">
    Build down in rank on any suit. Only pure K→A runs in one suit are removed.
    Click a card to move sequences. Double-click to auto-move onto the next higher card if possible.
  </div>

  <section id="tableau">
    <div class="column" data-column="0"></div>
    <div class="column" data-column="1"></div>
    <div class="column" data-column="2"></div>
    <div class="column" data-column="3"></div>
    <div class="column" data-column="4"></div>
    <div class="column" data-column="5"></div>
    <div class="column" data-column="6"></div>
    <div class="column" data-column="7"></div>
    <div class="column" data-column="8"></div>
    <div class="column" data-column="9"></div>
  </section>
</main>

<script>
/* -----------------------------------------
   SPIDER SOLITAIRE ENGINE (with difficulty)
   ----------------------------------------- */

const RANKS = [1,2,3,4,5,6,7,8,9,10,11,12,13];

let currentDifficulty = "easy"; // "easy" | "medium" | "hard"

let deck = [];
let tableaus = [];
let stock = [];
let foundations = [];
let selected = null;

const tableauEls = [...document.querySelectorAll(".column")];
const stockEl = document.getElementById("stock");
const stockCountEl = document.getElementById("stockCount");
const foundationEls = [...document.querySelectorAll(".foundation-slot")];
const diffButtons = [...document.querySelectorAll(".diff-btn")];

/* ---------- Difficulty handling ---------- */

diffButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const diff = btn.dataset.diff;
    currentDifficulty = diff;
    diffButtons.forEach(b => b.classList.toggle("active", b === btn));
    startNewGame();
  });
});

/* ---------- Deck building based on difficulty ---------- */

function buildDeck() {
  deck = [];

  let suits;
  let copiesPerSuit;

  if (currentDifficulty === "easy") {
    // 1 suit — 8 copies of each rank (104 cards)
    suits = ["♠"];
    copiesPerSuit = 8;
  } else if (currentDifficulty === "medium") {
    // 2 suits — 4 copies each (2 decks)
    suits = ["♠", "♥"];
    copiesPerSuit = 4;
  } else {
    // hard: 4 suits — 2 copies each (2 decks)
    suits = ["♠", "♥", "♦", "♣"];
    copiesPerSuit = 2;
  }

  for (const suit of suits) {
    for (let copy = 0; copy < copiesPerSuit; copy++) {
      for (const rank of RANKS) {
        deck.push({
          id: deck.length,
          suit,
          rank,
          faceUp: false
        });
      }
    }
  }
}

/* Fisher–Yates shuffle */
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

/* ---------- New game ---------- */

function startNewGame() {
  buildDeck();
  shuffle(deck);

  tableaus = Array.from({length: 10}, () => []);
  stock = [];
  foundations = [];
  selected = null;

  let index = 0;
  for (let col = 0; col < 10; col++) {
    const count = col < 4 ? 6 : 5;
    for (let i = 0; i < count; i++) {
      const card = deck[index++];
      tableaus[col].push(card.id);
    }
    const lastId = tableaus[col][tableaus[col].length - 1];
    deck[lastId].faceUp = true;
  }

  while (index < deck.length) stock.push(deck[index++].id);

  renderAll();
}

/* ---------- Rendering ---------- */

function renderAll() {
  renderStock();
  renderFoundations();
  renderTableau();
}

function renderStock() {
  stockCountEl.textContent = Math.floor(stock.length / 10);
}

function renderFoundations() {
  foundationEls.forEach((el, i) => {
    el.textContent = i < foundations.length ? "K→A" : "";
  });

  if (foundations.length === 8) {
    setTimeout(() => alert("You win! All 8 runs completed."), 100);
  }
}

function rankToSymbol(rank) {
  if (rank === 1) return "A";
  if (rank === 11) return "J";
  if (rank === 12) return "Q";
  if (rank === 13) return "K";
  return String(rank);
}

function suitClass(suit) {
  if (suit === "♠") return "suit-spades";
  if (suit === "♣") return "suit-clubs";
  if (suit === "♥") return "suit-hearts";
  return "suit-diamonds";
}

function renderTableau() {
  tableauEls.forEach((colEl, colIndex) => {
    colEl.innerHTML = "";
    const colCards = tableaus[colIndex];

    colCards.forEach((cardId, idx) => {
      const card = deck[cardId];
      const cardEl = document.createElement("div");
      cardEl.classList.add("card");
      cardEl.dataset.column = colIndex;
      cardEl.dataset.index = idx;
      cardEl.style.top = `${idx * 24}px`;

      if (!card.faceUp) {
        cardEl.classList.add("face-down");
      } else {
        cardEl.classList.add("face-up");
        const rank = rankToSymbol(card.rank);
        const sClass = suitClass(card.suit);
        cardEl.innerHTML = `
          <div class="rank-top">
            <span>${rank}</span>
            <span class="suit ${sClass}">${card.suit}</span>
          </div>
          <div class="center-suit suit ${sClass}">${card.suit}</div>
          <div class="rank-bottom">
            <span>${rank}</span>
            <span class="suit ${sClass}">${card.suit}</span>
          </div>
        `;
      }

      if (selected && selected.col === colIndex && idx >= selected.index) {
        cardEl.classList.add("selected");
      }

      cardEl.addEventListener("click", onCardClick);
      cardEl.addEventListener("dblclick", onCardDoubleClick);
      colEl.appendChild(cardEl);
    });
  });
}

/* ---------- Sequence & move rules ---------- */

// True if from index downward is a same-suit descending sequence
function isSameSuitSequence(col, index) {
  const ids = tableaus[col];
  for (let i = index; i < ids.length - 1; i++) {
    const a = deck[ids[i]];
    const b = deck[ids[i + 1]];
    if (!a.faceUp || !b.faceUp) return false;
    if (a.suit !== b.suit) return false;
    if (a.rank !== b.rank + 1) return false;
  }
  return true;
}

// Can we build movingTop onto destTop?
function canBuildOn(destTop, movingTop) {
  return destTop.faceUp && destTop.rank === movingTop.rank + 1;
}

/* ---------- Click / double-click handlers ---------- */

function onCardClick(e) {
  const col = Number(e.currentTarget.dataset.column);
  const index = Number(e.currentTarget.dataset.index);
  const colCards = tableaus[col];
  const card = deck[colCards[index]];

  // Flip top face-down card
  if (!card.faceUp) {
    if (index === colCards.length - 1) {
      card.faceUp = true;
      renderTableau();
    }
    return;
  }

  if (!selected) {
    // select a same-suit descending sequence (or single card)
    if (!isSameSuitSequence(col, index)) return;
    selected = { col, index };
    renderTableau();
    return;
  }

  // Click inside selected stack → deselect
  if (selected.col === col && index >= selected.index) {
    selected = null;
    renderTableau();
    return;
  }

  // Try move selected stack
  if (moveSequence(selected.col, selected.index, col)) {
    selected = null;
    renderAll();
    checkForCompletedRun();
  } else {
    selected = null;
    renderTableau();
  }
}

function onCardDoubleClick(e) {
  const col = Number(e.currentTarget.dataset.column);
  const index = Number(e.currentTarget.dataset.index);

  if (!isSameSuitSequence(col, index)) return;

  const movingTop = deck[tableaus[col][index]];

  // find first column with valid top card one rank higher
  for (let tcol = 0; tcol < 10; tcol++) {
    if (tcol === col) continue;
    const dest = tableaus[tcol];
    if (dest.length === 0) continue; // don't auto-move to empty

    const destTop = deck[dest[dest.length - 1]];
    if (canBuildOn(destTop, movingTop)) {
      moveSequence(col, index, tcol);
      selected = null;
      renderAll();
      checkForCompletedRun();
      return;
    }
  }
}

/* ---------- Core move function ---------- */

function moveSequence(fromCol, fromIndex, toCol) {
  if (fromCol === toCol) return false;

  const source = tableaus[fromCol];
  const dest = tableaus[toCol];
  const movingIds = source.slice(fromIndex);
  const movingTop = deck[movingIds[0]];

  // if target not empty, must build correctly
  if (dest.length > 0) {
    const destTop = deck[dest[dest.length - 1]];
    if (!canBuildOn(destTop, movingTop)) return false;
  }

  // perform move
  tableaus[fromCol] = source.slice(0, fromIndex);
  tableaus[toCol] = dest.concat(movingIds);

  // flip new top of source if needed
  const src = tableaus[fromCol];
  if (src.length > 0) deck[src[src.length - 1]].faceUp = true;

  return true;
}

/* ---------- Completed run detection ---------- */

function checkForCompletedRun() {
  for (let col = 0; col < 10; col++) {
    const ids = tableaus[col];
    if (ids.length < 13) continue;

    const slice = ids.slice(ids.length - 13);
    const suit = deck[slice[0]].suit;
    let ok = true;

    for (let i = 0; i < 13; i++) {
      const card = deck[slice[i]];
      if (!card.faceUp || card.suit !== suit || card.rank !== 13 - i) {
        ok = false;
        break;
      }
    }

    if (ok) {
      tableaus[col] = ids.slice(0, ids.length - 13);
      foundations.push(slice);

      const remain = tableaus[col];
      if (remain.length > 0) {
        deck[remain[remain.length - 1]].faceUp = true;
      }
      renderAll();
    }
  }
}

/* ---------- Stock dealing ---------- */

stockEl.addEventListener("click", () => {
  if (stock.length === 0) return;
  // cannot deal if any column is empty
  for (let col = 0; col < 10; col++) {
    if (tableaus[col].length === 0) return;
  }

  for (let col = 0; col < 10; col++) {
    const cardId = stock.pop();
    const card = deck[cardId];
    card.faceUp = true;
    tableaus[col].push(cardId);
  }

  selected = null;
  renderAll();
});

/* ---------- New game ---------- */

document.getElementById("newGameBtn").addEventListener("click", startNewGame);

/* ---------- Start ---------- */

startNewGame();
</script>
</body>
</html>
